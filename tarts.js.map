{"version":3,"file":"tarts.js","sources":["lib/index.js"],"sourcesContent":["const headers = {\n  name: 100,\n  mode: 8,\n  uid: 8,\n  gid: 8,\n  size: 12,\n  mtime: 12,\n  chksum: 8,\n  typeflag: 1,\n  linkname: 100,\n  magic: 5,\n  version: 2,\n  uname: 32,\n  gname: 32,\n  devmajor: 8,\n  devminor: 8,\n  prefix: 155,\n  padding: 12\n}\n\nconst offsets = {}\nObject.keys(headers).reduce((acc, k) => {\n  offsets[k] = acc\n  return acc + headers[k]\n}, 0)\n\nconst defaults = f => ({\n  name: f.name,\n  mode: '777',\n  uid: 0,\n  gid: 0,\n  size: f.content.byteLength,\n  mtime: Math.floor(Number(new Date()) / 1000),\n  chksum: '        ',\n  typeflag: '0',\n  magic: 'ustar',\n  version: '  ',\n  uname: '',\n  gname: ''\n})\n\nconst nopad = ['name', 'linkname', 'magic', 'chksum', 'typeflag', 'version', 'uname', 'gname']\n    , bsize = 512\n\nexport default files => {\n  return files.reduce((a, f) => {\n    if (typeof f.content === 'string')\n      f.content = stringToUint8(f.content)\n\n    f = Object.assign(defaults(f), f)\n\n    const b = new Uint8Array(Math.ceil((bsize + f.size) / bsize) * bsize)\n\n    const checksum = Object.keys(headers).reduce((acc, k) => {\n      if (!(k in f))\n        return acc\n\n      const value = stringToUint8(nopad.indexOf(k) > -1\n        ? f[k]\n        : pad(f[k], headers[k] - 1))\n\n      b.set(value, offsets[k])\n      return acc + value.reduce((a, b) => a + b, 0)\n    }, 0)\n\n    b.set(stringToUint8(pad(checksum, 7)), offsets.chksum)\n    b.set(f.content, bsize)\n\n    const sum = new Uint8Array(a.byteLength + b.byteLength)\n    sum.set(a, 0)\n    sum.set(b, a.byteLength)\n\n    return sum\n  }, new Uint8Array(0))\n}\n\nfunction pad(s, n) {\n  s = s.toString(8)\n  return ('000000000000' + s).slice(s.length + 12 - n)\n}\n\nfunction stringToUint8(s) {\n  const a = new Uint8Array(s.length)\n  for (let i = 0; i < s.length; i++)\n    a[i] = s.charCodeAt(i)\n  return a\n}\n"],"names":["const","let"],"mappings":"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"}