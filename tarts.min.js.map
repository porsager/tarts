{"version":3,"file":"tarts.min.js","sources":["lib/index.js"],"sourcesContent":["const headers = {\n  name: 100,\n  mode: 8,\n  uid: 8,\n  gid: 8,\n  size: 12,\n  mtime: 12,\n  chksum: 8,\n  typeflag: 1,\n  linkname: 100,\n  magic: 5,\n  version: 2,\n  uname: 32,\n  gname: 32,\n  devmajor: 8,\n  devminor: 8,\n  prefix: 155,\n  padding: 12\n}\n\nconst offsets = {}\nObject.keys(headers).reduce((acc, k) => {\n  offsets[k] = acc\n  return acc + headers[k]\n}, 0)\n\nconst defaults = f => ({\n  name: f.name,\n  mode: '777',\n  uid: 0,\n  gid: 0,\n  size: f.content.byteLength,\n  mtime: Math.floor(Number(new Date()) / 1000),\n  chksum: '        ',\n  typeflag: '0',\n  magic: 'ustar',\n  version: '  ',\n  uname: '',\n  gname: ''\n})\n\nconst nopad = ['name', 'linkname', 'magic', 'chksum', 'typeflag', 'version', 'uname', 'gname']\n    , bsize = 512\n\nexport default files => {\n  return files.reduce((a, f) => {\n    if (typeof f.content === 'string')\n      f.content = stringToUint8(f.content)\n\n    f = Object.assign(defaults(f), f)\n\n    const b = new Uint8Array(Math.ceil((bsize + f.size) / bsize) * bsize)\n\n    const checksum = Object.keys(headers).reduce((acc, k) => {\n      if (!(k in f))\n        return acc\n\n      const value = stringToUint8(nopad.indexOf(k) > -1\n        ? f[k]\n        : pad(f[k], headers[k] - 1))\n\n      b.set(value, offsets[k])\n      return acc + value.reduce((a, b) => a + b, 0)\n    }, 0)\n\n    b.set(stringToUint8(pad(checksum, 7)), offsets.chksum)\n    b.set(f.content, bsize)\n\n    const sum = new Uint8Array(a.byteLength + b.byteLength)\n    sum.set(a, 0)\n    sum.set(b, a.byteLength)\n\n    return sum\n  }, new Uint8Array(0))\n}\n\nfunction pad(s, n) {\n  s = s.toString(8)\n  return ('000000000000' + s).slice(s.length + 12 - n)\n}\n\nfunction stringToUint8(s) {\n  const a = new Uint8Array(s.length)\n  for (let i = 0; i < s.length; i++)\n    a[i] = s.charCodeAt(i)\n  return a\n}\n"],"names":["const","headers","name","mode","uid","gid","size","mtime","chksum","typeflag","linkname","magic","version","uname","gname","devmajor","devminor","prefix","padding","offsets","Object","keys","reduce","acc","k","nopad","bsize","pad","s","n","toString","slice","length","stringToUint8","a","Uint8Array","i","charCodeAt","files","f","content","assign","byteLength","Math","floor","Number","Date","b","ceil","checksum","value","indexOf","set","sum"],"mappings":"+KAAAA,IAAMC,EAAU,CACdC,KAAM,IACNC,KAAM,EACNC,IAAK,EACLC,IAAK,EACLC,KAAM,GACNC,MAAO,GACPC,OAAQ,EACRC,SAAU,EACVC,SAAU,IACVC,MAAO,EACPC,QAAS,EACTC,MAAO,GACPC,MAAO,GACPC,SAAU,EACVC,SAAU,EACVC,OAAQ,IACRC,QAAS,IAGLC,EAAU,GAChBC,OAAOC,KAAKpB,GAASqB,gBAAQC,EAAKC,GAEhC,OADAL,EAAQK,GAAKD,GACAtB,EAAQuB,IACpB,GAEHxB,IAeMyB,EAAQ,CAAC,OAAQ,WAAY,QAAS,SAAU,WAAY,UAAW,QAAS,SAChFC,EAAQ,IAkCd,SAASC,EAAIC,EAAGC,GAEd,OAAQ,gBADRD,EAAIA,EAAEE,SAAS,KACaC,MAAMH,EAAEI,OAAS,GAAKH,GAGpD,SAASI,EAAcL,GAErB,IADA5B,IAAMkC,EAAI,IAAIC,WAAWP,EAAEI,QAClBI,EAAI,EAAGA,EAAIR,EAAEI,OAAQI,IAC5BF,EAAEE,GAAKR,EAAES,WAAWD,GACtB,OAAOF,kBAzCMI,GACb,OAAOA,EAAMhB,gBAAQY,EAAGK,OAnBTA,EAoBY,iBAAdA,EAAEC,UACXD,EAAEC,QAAUP,EAAcM,EAAEC,UAE9BD,EAAInB,OAAOqB,QAtBbvC,MADeqC,EAuBcA,GAtBrBrC,KACRC,KAAM,MACNC,IAAK,EACLC,IAAK,EACLC,KAAMiC,EAAEC,QAAQE,WAChBnC,MAAOoC,KAAKC,MAAMC,OAAO,IAAIC,MAAU,KACvCtC,OAAQ,WACRC,SAAU,IACVE,MAAO,QACPC,QAAS,KACTC,MAAO,GACPC,MAAO,IAW0ByB,GAE/BvC,IAAM+C,EAAI,IAAIZ,WAAWQ,KAAKK,MAAMtB,EAAQa,EAAEjC,MAAQoB,GAASA,GAEzDuB,EAAW7B,OAAOC,KAAKpB,GAASqB,gBAAQC,EAAKC,GACjD,KAAMA,KAAKe,GACT,OAAOhB,EAETvB,IAAMkD,EAAQjB,GAAkC,EAApBR,EAAM0B,QAAQ3B,GACtCe,EAAEf,GACFG,EAAIY,EAAEf,GAAIvB,EAAQuB,GAAK,IAG3B,OADAuB,EAAEK,IAAIF,EAAO/B,EAAQK,IACdD,EAAM2B,EAAM5B,gBAAQY,EAAGa,UAAMb,EAAIa,GAAG,IAC1C,GAEHA,EAAEK,IAAInB,EAAcN,EAAIsB,EAAU,IAAK9B,EAAQX,QAC/CuC,EAAEK,IAAIb,EAAEC,QAASd,GAEjB1B,IAAMqD,EAAM,IAAIlB,WAAWD,EAAEQ,WAAaK,EAAEL,YAI5C,OAHAW,EAAID,IAAIlB,EAAG,GACXmB,EAAID,IAAIL,EAAGb,EAAEQ,YAENW,GACN,IAAIlB,WAAW"}