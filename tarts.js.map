{"version":3,"file":"tarts.js","sources":["lib/index.js"],"sourcesContent":["const headers = {\n  name: 100,\n  mode: 8,\n  uid: 8,\n  gid: 8,\n  size: 12,\n  mtime: 12,\n  chksum: 8,\n  typeflag: 1,\n  linkname: 100,\n  magic: 5,\n  version: 2,\n  uname: 32,\n  gname: 32,\n  devmajor: 8,\n  devminor: 8,\n  prefix: 155,\n  padding: 12\n}\n\nconst offsets = {}\nObject.keys(headers).reduce((acc, k) => {\n  offsets[k] = acc\n  return acc + headers[k]\n}, 0)\n\nconst defaults = f => ({\n  name: f.name,\n  mode: '777',\n  uid: 0,\n  gid: 0,\n  size: f.content.byteLength,\n  mtime: Math.floor(Number(new Date()) / 1000),\n  chksum: '        ',\n  typeflag: '0',\n  magic: 'ustar',\n  version: '  ',\n  uname: '',\n  gname: ''\n})\n\nconst nopad = ['name', 'linkname', 'magic', 'chksum', 'typeflag', 'version', 'uname', 'gname']\n    , bsize = 512\n\nexport default files => {\n  return files.reduce((a, f) => {\n    if (typeof f.content === 'string')\n      f.content = stringToUint8(f.content)\n\n    f = Object.assign(defaults(f), f)\n\n    const b = new Uint8Array(Math.ceil((bsize + f.size) / bsize) * bsize)\n\n    const checksum = Object.keys(headers).reduce((acc, k) => {\n      if (!(k in f))\n        return acc\n\n      const value = stringToUint8(nopad.indexOf(k) > -1\n        ? f[k]\n        : pad(f[k], headers[k] - 1))\n\n      b.set(value, offsets[k])\n      return acc + value.reduce((a, b) => a + b, 0)\n    }, 0)\n\n    b.set(stringToUint8(pad(checksum, 7)), offsets.chksum)\n    b.set(f.content, bsize)\n\n    const sum = new Uint8Array(a.byteLength + b.byteLength)\n    sum.set(a, 0)\n    sum.set(b, a.byteLength)\n\n    return sum\n  }, new Uint8Array(0))\n}\n\nfunction pad(s, n) {\n  s = s.toString(8)\n  return ('000000000000' + s).slice(s.length + 12 - n)\n}\n\nfunction stringToUint8(s) {\n  const a = new Uint8Array(s.length)\n  for (let i = 0; i < s.length; i++)\n    a[i] = s.charCodeAt(i)\n  return a\n}\n"],"names":["const","let"],"mappings":"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"}